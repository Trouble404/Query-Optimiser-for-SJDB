# Query-Optimiser-for-SJDB
Database Programming Exercise


## 可优化的思路


* （1）子句局部优化。
如等价谓词重写，WHERE和HAVING条件化简中的大部分情况。

* （2）子句间关联优化。
子句与子句之间关联的语义存在优化的可能，如外连接消除、连接消除、子查询优化、视图重写等。

* （3）局部与整体的优化。
协同局部与整体。如OR重写并集规则需要考虑UNION操作（UNION是变换后的整体形式）的花费和OR操作（OR是局部表达式）的花费。

* （4）形式变化优化
多个子句存在嵌套，可能通过形式的变化完成优化。如：嵌套连接消除。

* （5）语义优化
根据完整性约束，SQL表达的含义等信息对语句进行语义优化

* （6）其他优化
根据一些规则对非SPJ做的其他优化，根据硬件环境进行的并行查询优化。

* 它们都是依据关系代数和启发式规则进行。

## 关系模型

### 关系数据结构

* 即二维结构，二维表。即数据库中的表。
* 关系是一种对象
* 关系即是表
* 关系的元数据，即表结构，通常称为列或属性。
* 关系的数据，即表的行数据，通常称为元组（`tuple`），也称为记录(`record`)。 

### 关系操作集合

* 并，交，差，积，选择，投影，连接，除。。
* 选择：单个关系中筛选元组。
* 投影：单个关系中筛选列。
* 连接：多个关系中根据列间的逻辑运算筛选元组（自然连接，等值连接）
* 除：多个关系中根据条件筛选元组（NOT EXISTS 的子查询实现除）
* 并：多个关系合并元组（用UNION实现并）
* 交：多个关系中根据条件筛选元组（用两次NOT IN 实现交）
* 差：多个关系中根据条件筛选元组（NOT IN 子查询实现差）
* 积：无连接条件。N*M条元组


### 关系类型

```
R <op> S
```

* 自然连接：R和S中“公共属性”，结果包括公共属性名字上相等的所有元组的组合，在结果中把重复的列去掉。（是同时从列和行的角度进行去重）

* @-连接：R和S中没有公共属性，结果包括在R和S中满足操作符@的所有组合。@通常包括：```< <=, =, =, >=```。即从关系R和S的广义笛卡儿积中选取A，B属性相等的那些元组，是从“行”的角度进行运算。

* 等值连接：操作符是 = 的@-连接。

* 半连接：结果包括在S中公共属性名字上相等的元组的所有的R中的元组。即结果包括R的部分元组，而R中的部分元组的公共属性的值在S中同样存在。SQL中没有自己的连接操作符，使用EXISTS， IN 关键字做子句的子查询常被查询优化器转换为半连接。

* 反连接：结果是在S中没有在公共属性名字上相等的元组的R的元组。即为半连接的补集，反连接有时称为反半连接。在SQL中没有自己的连接操作符，使用了 NOT EXISTS 则被查询优化器转换为反半连接。

* 外连接（左外连接）：结果包括R中的所有元组。若在S中有在公共属性名字上相等的元组，则正常连接；若在S中没有公共属性名字上相等的元组，则依旧保留此元组，并将对应的其他列设为NULL

* 外连接（右外连接）：结果包括S中的所有元组。若在R中有在公共属性名字上相等的元组，则正常连接；若在R中没有公共属性名字上相等的元组，则依旧保留此元组，并将对应的其他列设为NULL

* 外连接（全外连接）：结果包括S和R中的所有元组。对于每个元组，若在另一个关系中有在公共属性名字上相等的元组，则正常连接；若在另一人关系中没有公共属性名字上相等的元组，则依旧保留此元组，并将对应的其他列设为NULL










